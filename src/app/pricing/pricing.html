<!-- Pricing Table -->
<section class="bg-[#fff] py-16 border-b border-[#e0e3e7]">
  <div class="max-w-7xl mx-auto px-4">
    <h2 class="text-3xl font-bold text-center mb-10 text-[#1a202c]">
      Find the right plan for your business. Try it free for 14 days.
    </h2>

    <!-- Loading State -->
    <div *ngIf="loading" class="text-center py-8">
      <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-[#1a73e8]"></div>
      <p class="mt-2 text-[#5f6368]">Loading pricing plans...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="text-center py-8">
      <p class="text-red-500">{{ error }}</p>
    </div>

    <!-- Status (after return from Stripe) -->
    <div *ngIf="!loading && statusData" class="max-w-3xl mx-auto mb-8 p-4 rounded-lg border border-[#e0e3e7]">
      <div class="font-semibold text-[#1a202c] mb-2">{{ statusMessage }}</div>
      <pre class="text-xs text-[#202124] bg-[#f8f9fa] p-3 rounded overflow-auto">{{ statusData | json }}</pre>
    </div>

    <!-- Pricing Cards -->
    <div *ngIf="!loading && !error" class="grid md:grid-cols-3 gap-6 md:gap-8">
      <div *ngFor="let tier of pricingTiers; let i = index"
           [class]="'pricing-card bg-white rounded-2xl shadow-lg p-8 flex flex-col items-center relative ' +
                    (isPopular(i) ? 'border-2 border-[#1a73e8]' : 'border border-[#e0e3e7]')">

        <!-- Popular Badge -->
        <div *ngIf="isPopular(i)"
             class="absolute top-0 -translate-y-1/2 bg-[#1a73e8] text-white text-xs font-bold px-4 py-1 rounded-full uppercase tracking-wider">
          Most Popular
        </div>

        <!-- Plan Name -->
        <h3 class="font-semibold text-lg mb-2 text-[#1a202c]">{{ tier.name }}</h3>

        <!-- Plan Description (placeholder) -->
        <div class="text-[#5f6368] mb-2 text-sm">
          <span *ngIf="i === 0">The perfect starter plan for your basic design needs.</span>
          <span *ngIf="i === 1">Crush all your design needs – including presentations.</span>
          <span *ngIf="i === 2">Level up your content with the <span class="text-[#1a73e8] font-medium">ultimate creative plan</span>.</span>
        </div>

        <!-- Price -->
        <div class="text-3xl font-extrabold mb-1 text-[#1a73e8] flex items-end">
          {{ formatPrice(tier.price) }}
          <span class="text-base font-medium ml-1 text-[#5f6368]">{{ '/' + tier.interval }}</span>
        </div>

        <!-- Get Started Button -->
        <button type="button"
                (click)="onGetStarted(tier)"
                [disabled]="cardButtonLoading[tier.id]"
                [class]="'pricing-btn w-full text-center px-4 py-2 rounded-lg font-medium transition mb-6 ' +
                         (isPopular(i) ? 'bg-[#1a73e8] text-white hover:bg-[#1765c1]' : 'bg-[#fff] text-[#1a73e8] border border-[#1a73e8] hover:bg-[#f5faff]')">
          <span *ngIf="!cardButtonLoading[tier.id]">Get Started</span>
          <span *ngIf="cardButtonLoading[tier.id]" class="inline-flex items-center">
            <span class="animate-spin rounded-full h-4 w-4 border-b-2 mr-2"></span> Starting…
          </span>
        </button>

        <!-- Features -->
        <div class="w-full">
          <h4 class="font-semibold text-[#1a202c] mb-3">Features</h4>
          <ul class="text-[#202124] text-sm w-full space-y-2">
            <li *ngFor="let feature of tier.features" class="flex items-start">
              <span class="text-green-500 mr-2 mt-0.5">✓</span>
              <span>{{ feature }}</span>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Checkout Modal -->
    <div *ngIf="showCheckoutModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
      <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-[#1a202c]">Start {{ selectedTier?.name }} plan</h3>
          <button (click)="closeModal()" class="text-[#5f6368] hover:text-[#1a202c]">✕</button>
        </div>

        <form (ngSubmit)="startCheckout()">
          <label class="block text-sm font-medium text-[#1a202c] mb-1">Email</label>
          <input type="email" [(ngModel)]="form.email" name="email" required
                 class="w-full border border-[#e0e3e7] rounded-lg px-3 py-2 mb-4 focus:outline-none focus:ring-2 focus:ring-[#1a73e8]" />

          <label class="block text-sm font-medium text-[#1a202c] mb-1">Password</label>
          <input type="password" [(ngModel)]="form.password" name="password" required
                 class="w-full border border[#e0e3e7] rounded-lg px-3 py-2 mb-6 focus:outline-none focus:ring-2 focus:ring-[#1a73e8]" />

          <div class="flex items-center justify-end gap-3">
            <button type="button" (click)="closeModal()"
                    class="px-4 py-2 rounded-lg border border-[#e0e3e7] text-[#1a202c]">
              Cancel
            </button>
            <button type="submit" [disabled]="startingCheckout"
                    class="px-4 py-2 rounded-lg bg-[#1a73e8] text-white hover:bg-[#1765c1]">
              <span *ngIf="!startingCheckout">Continue to Checkout</span>
              <span *ngIf="startingCheckout" class="inline-flex items-center">
                <span class="animate-spin rounded-full h-4 w-4 border-b-2 mr-2"></span> Redirecting…
              </span>
            </button>
          </div>
        </form>
      </div>
    </div>

  </div>
</section>
